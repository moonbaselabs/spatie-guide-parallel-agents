---
description: Refactor code to follow Spatie guidelines with extended thinking
argument-hint: [file or class to refactor]
---

<extended-thinking>
Perform deep refactoring analysis following Spatie guidelines.

Target: $ARGUMENTS

Comprehensive refactoring process:
1. Analyze current code structure and identify all violations
2. Plan refactoring strategy preserving functionality
3. Consider impacts on other parts of the codebase
4. Apply Spatie patterns systematically

Use the Task tool to run these agents for analysis:
- **class-structure** - Improve class design
- **control-flow** - Optimize control flow
- **code-quality** - Enhance overall quality
- **core-laravel** - Align with Laravel patterns

Refactoring priorities:
1. Extract complex methods into smaller ones
2. Convert to early return patterns
3. Implement proper type declarations
4. Use constructor property promotion
5. Extract business logic to service classes
6. Implement proper validation
7. Add resource transformers
8. Improve error handling

Create a step-by-step refactoring plan showing:
- Current problematic code
- Refactored solution
- Explanation of improvements
- Any breaking changes
- Testing recommendations

Apply the refactoring and show before/after comparison.